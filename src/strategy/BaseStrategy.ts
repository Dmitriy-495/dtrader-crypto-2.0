/**
 * Базовый абстрактный класс для торговых стратегий
 */

import { Candle, Tick, Signal } from "../types";

// ============================================================================
// ИНТЕРФЕЙСЫ
// ============================================================================

/**
 * Базовая конфигурация стратегии
 */
export interface BaseStrategyConfig {
  symbol: string; // Торговая пара
  interval: string; // Интервал свечей
  enabled: boolean; // Включена ли стратегия
}

// ============================================================================
// БАЗОВЫЙ КЛАСС СТРАТЕГИИ
// ============================================================================

export abstract class BaseStrategy {
  protected config: BaseStrategyConfig;
  protected name: string;

  /**
   * Конструктор
   */
  constructor(name: string, config: BaseStrategyConfig) {
    this.name = name;
    this.config = config;
  }

  // ==========================================================================
  // АБСТРАКТНЫЕ МЕТОДЫ (должны быть реализованы в дочерних классах)
  // ==========================================================================

  /**
   * Вызывается при запуске стратегии
   */
  abstract onStart(): void;

  /**
   * Вызывается при остановке стратегии
   */
  abstract onStop(): void;

  /**
   * Вызывается при получении нового тика
   */
  abstract onTick(tick: Tick): void;

  /**
   * Вызывается при формировании новой свечи
   * Здесь должна находиться основная логика стратегии
   */
  abstract onCandle(candle: Candle, history: Candle[]): Signal | null;

  // ==========================================================================
  // ОБЩИЕ МЕТОДЫ
  // ==========================================================================

  /**
   * Получить имя стратегии
   */
  getName(): string {
    return this.name;
  }

  /**
   * Получить конфигурацию
   */
  getConfig(): BaseStrategyConfig {
    return this.config;
  }

  /**
   * Проверить, включена ли стратегия
   */
  isEnabled(): boolean {
    return this.config.enabled;
  }

  /**
   * Включить стратегию
   */
  enable(): void {
    this.config.enabled = true;
    console.log(`✅ Стратегия ${this.name} включена`);
  }

  /**
   * Выключить стратегию
   */
  disable(): void {
    this.config.enabled = false;
    console.log(`⏸️  Стратегия ${this.name} выключена`);
  }
}
